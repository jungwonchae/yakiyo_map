<!DOCTYPE html>
<html lang="ko">
  <head>
    <meta charset="utf-8" />
    <title>Yakiyo Kakao Map</title>

    <style>
      html,
      body {
        margin: 0;
        padding: 0;
        width: 100%;
        height: 100%;
      }
      #map {
        width: 100%;
        height: 100%;
      }
    </style>

    <!-- Kakao Maps JS SDK (ì›¹ìš© ì•±í‚¤ / ë„ë©”ì¸ í—ˆìš© í•„ìˆ˜) -->
    <script src="https://dapi.kakao.com/v2/maps/sdk.js?appkey=76db1590d48d0c7bf7d8a1b4ce4147e4&autoload=false"></script>

    <script>
      let map = null;
      let markers = [];
      let myMarker = null; // ë‚´ ìœ„ì¹˜ ë§ˆì»¤

      function log() {
        console.log.apply(console, arguments);
      }

      // ì§€ë„ ì´ˆê¸°í™”
      function initMap() {
        kakao.maps.load(function () {
          const container = document.getElementById("map");
          const options = {
            center: new kakao.maps.LatLng(37.5665, 126.9780), // ì„œìš¸ ì‹œì²­ ê·¼ì²˜
            level: 3, // ê¸°ë³¸ ì¤Œ(ìˆ«ì ì‘ì„ìˆ˜ë¡ í™•ëŒ€)
          };
          map = new kakao.maps.Map(container, options);
          log("ğŸ—º Kakao Map ì´ˆê¸°í™” ì™„ë£Œ");
        });
      }

      // Flutterì—ì„œ í˜¸ì¶œí•˜ëŠ” í•¨ìˆ˜
      // centerLat, centerLng : ì¤‘ì‹¬(ë³´í†µ ë‚´ ìœ„ì¹˜)
      // markersJson : [{ name, lat, lng }, ...] í˜•íƒœ JSON ë¬¸ìì—´
      window.setCenterAndMarkers = function (centerLat, centerLng, markersJson) {
        if (!map) {
          log("âš ï¸ map ì•„ì§ ì¤€ë¹„ ì•ˆ ë¨. ì ì‹œ í›„ ë‹¤ì‹œ í˜¸ì¶œ í•„ìš”");
          return;
        }

        const center = new kakao.maps.LatLng(centerLat, centerLng);

        // ì´ì „ ë§ˆì»¤ ì œê±°
        markers.forEach((m) => m.setMap(null));
        markers = [];
        if (myMarker) {
          myMarker.setMap(null);
          myMarker = null;
        }

        // ğŸ”¹ ë‚´ ìœ„ì¹˜ ë§ˆì»¤
        myMarker = new kakao.maps.Marker({
          map: map,
          position: center,
          title: "ë‚´ ìœ„ì¹˜",
        });

        // ì§€ë„ ë²”ìœ„ ê³„ì‚°ìš© bounds
        let bounds = new kakao.maps.LatLngBounds();
        bounds.extend(center); // ë‚´ ìœ„ì¹˜ í¬í•¨

        try {
          const list = JSON.parse(markersJson);

          list.forEach((item) => {
            const pos = new kakao.maps.LatLng(item.lat, item.lng);
            const marker = new kakao.maps.Marker({
              map: map,
              position: pos,
              title: item.name,
            });
            markers.push(marker);
            bounds.extend(pos); // ì•½êµ­ ìœ„ì¹˜ë„ boundsì— ì¶”ê°€
          });

          log("ğŸ“Œ ì•½êµ­ ë§ˆì»¤ ê°œìˆ˜:", list.length);
        } catch (e) {
          log("âŒ markersJson íŒŒì‹± ì‹¤íŒ¨:", e);
        }

        // ğŸ” ëª¨ë“  ë§ˆì»¤ê°€ í™”ë©´ì— ë³´ì´ë„ë¡
        map.setBounds(bounds);

        // ë„ˆë¬´ ë©€ë¦¬ ì¡íˆë©´ í•œ ë²ˆ ë” í™•ëŒ€
        if (map.getLevel() > 5) {
          map.setLevel(5);
        }
      };

      // DOM ë¡œë“œ í›„ Kakao SDK í™•ì¸
      document.addEventListener("DOMContentLoaded", function () {
        if (typeof kakao === "undefined") {
          log("âŒ kakao ì „ì—­ ê°ì²´ ì—†ìŒ (SDK ë¡œë“œ ì‹¤íŒ¨)");
          return;
        }
        initMap();
      });
    </script>
  </head>

  <body>
    <div id="map"></div>
  </body>
</html>
