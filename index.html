<!DOCTYPE html>
<html lang="ko">
  <head>
    <meta charset="utf-8" />
    <title>Yakiyo Kakao Map</title>
    <style>
      html, body {
        margin: 0;
        padding: 0;
        width: 100%;
        height: 100%;
      }
      #map {
        width: 100%;
        height: 100%;
      }
    </style>

    <script src="https://dapi.kakao.com/v2/maps/sdk.js?appkey=76db1590d48d0c7bf7d8a1b4ce4147e4&autoload=false"></script>

    <script>
      // 디버그용 (웹 콘솔)
      function log() {
        console.log.apply(console, arguments);
      }

      // 전역 변수
      let map = null;
      let markers = [];

      // 지도 초기화
      function initMap() {
        kakao.maps.load(function () {
          const container = document.getElementById('map');
          const options = {
            center: new kakao.maps.LatLng(37.5665, 126.9780),
            level: 4,
          };
          map = new kakao.maps.Map(container, options);
          log(' Kakao Map 초기화 완료');
        });
      }

      window.setCenterAndMarkers = function (centerLat, centerLng, markersJson) {
        if (!map) {
          log('map 아직 준비 안 됨. 잠시 후 다시 호출 필요');
          return;
        }

        const center = new kakao.maps.LatLng(centerLat, centerLng);
        map.setCenter(center);

        markers.forEach(m => m.setMap(null));
        markers = [];

        try {
          const list = JSON.parse(markersJson);

          list.forEach(item => {
            const marker = new kakao.maps.Marker({
              map: map,
              position: new kakao.maps.LatLng(item.lat, item.lng),
              title: item.name,
            });
            markers.push(marker);
          });
        } catch (e) {
          log('markersJson 파싱 실패:', e);
        }
      };

      document.addEventListener('DOMContentLoaded', function () {
        if (typeof kakao === 'undefined') {
          log('kakao 전역 객체가 없습니다 (SDK 로드 실패)');
          return;
        }
        initMap();
      });
    </script>
  </head>

  <body>
    <div id="map"></div>
  </body>
</html>
